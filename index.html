<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>لعبة النقاط - 4 لاعبين</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
    :root{ --bg:#12131a; --card:#1b1d2a; --accent:#00d4b4; --muted:#9aa0b2; --danger:#e83a4b; --btn:#2196f3 }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Cairo",sans-serif;
      background: linear-gradient(180deg,#0f1114,#15161a);
      color:#fff;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .wrap{
      width:100%;
      max-width:920px;
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:20px;
    }

    /* اللوحة الرئيسية */
    .board{
      background: rgba(255,255,255,0.02);
      border-radius:14px;
      padding:18px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      min-height: 420px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }

    .title{
      font-weight:700;
      color:var(--accent);
      font-size:1.15rem;
    }

    .status{
      font-size:0.95rem;
      color:var(--muted);
    }

    .score{
      text-align:center;
      padding:14px;
      background:linear-gradient(90deg, rgba(0,0,0,0.15), rgba(255,255,255,0.02));
      border-radius:10px;
      box-shadow: inset 0 -2px 6px rgba(0,0,0,0.2);
    }

    .score h3{margin-bottom:6px;color:var(--muted);font-weight:600}
    .score .value{font-size:38px;color:var(--accent);font-weight:800}

    .players-row{
      display:flex;
      gap:8px;
      justify-content:space-between;
      margin-top:6px;
    }

    .player-box{
      flex:1;
      padding:8px 10px;
      background:rgba(255,255,255,0.02);
      border-radius:8px;
      text-align:center;
      font-weight:700;
      color:var(--muted);
    }
    .player-box.active{ background: linear-gradient(90deg,#06202a22,#00000022); color:var(--accent); box-shadow:0 6px 18px rgba(0,0,0,0.4) }

    .options{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:12px;
    }

    .opt-btn{
      padding:12px;
      border-radius:10px;
      background:linear-gradient(180deg,#1e2433,#171923);
      border:1px solid rgba(255,255,255,0.03);
      cursor:pointer;
      font-weight:700;
      color:#fff;
      text-align:center;
      transition:transform .12s ease, opacity .12s ease;
    }
    .opt-btn:active{ transform:translateY(2px) }
    .opt-btn.disabled{ opacity:0.35; cursor:not-allowed; filter:grayscale(.2) }

    /* المنطقة اليمنى */
    .side{
      background: rgba(255,255,255,0.02);
      border-radius:14px;
      padding:16px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      min-height:420px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .panel{
      background: linear-gradient(180deg,#0f1720,#0b0d11);
      padding:12px;
      border-radius:10px;
    }

    label{display:block;margin-bottom:6px;color:var(--muted);font-weight:600}
    select,input{ width:100%; padding:10px; border-radius:8px; border:none; outline:none; background:#0b1116; color:#fff }

    .action-row{ display:flex; gap:8px; margin-top:8px }
    .btn{ flex:1; padding:10px; border-radius:8px; cursor:pointer; border:none; font-weight:700 }
    .btn.primary{ background:var(--btn); color:#fff }
    .btn.warn{ background:var(--danger); color:#fff }
    .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted) }

    /* السجل */
    #historyLog{ overflow:auto; max-height:220px; padding:8px; border-radius:8px; background:rgba(255,255,255,0.02) }
    .log-item{ padding:8px; margin-bottom:8px; border-radius:8px; background:linear-gradient(90deg,#00000022,#00000011); font-size:14px; color:#e6eef1 }

    /* شاشة صغيرة - جواهرية */
    @media (max-width:900px){
      .wrap{ grid-template-columns: 1fr; }
      .side{ order: -1; }
    }
  </style>
</head>
<body>

  <div class="wrap">

    <!-- اللوحة اليسارية: الخيارات واللاعبين -->
    <div class="board">
      <div class="header">
        <div class="title">لعبة النقاط — 4 لاعبين</div>
        <div class="status" id="turnStatus">الدور: اللاعب 1 من 4</div>
      </div>

      <div class="score">
        <h3>المجموع الكلي</h3>
        <div class="value" id="totalScore">0</div>
        <div class="players-row" id="playersRow">
          <div class="player-box active" id="player-1">لاعب 1</div>
          <div class="player-box" id="player-2">لاعب 2</div>
          <div class="player-box" id="player-3">لاعب 3</div>
          <div class="player-box" id="player-4">لاعب 4</div>
        </div>
      </div>

      <div style="margin-top:10px; color:var(--muted); font-weight:600">اختر أحد الخيارات ثم حدّد القيمة ثم اضغط تأكيد:</div>

      <div class="options" id="optionsArea">
        <div class="opt-btn" data-opt="queen">بنات</div>
        <div class="opt-btn" data-opt="king">دينار</div>
        <div class="opt-btn" data-opt="slap">لطش</div>
        <div class="opt-btn" data-opt="picker">ختيار</div>
        <div class="opt-btn" data-opt="trex">تركس</div>
      </div>

      <div style="margin-top:12px; color:var(--muted); font-size:13px">
        ملاحظة: كل لاعب لا يستطيع إعادة اختيار نفس الخيار مرتين. بعد أن يكمل اللاعب الخمس خيارات ينتقل الدور للاعب التالي.
      </div>
    </div>

    <!-- اللوحة اليمنى: تحكم / اختيار القيمة / سجل -->
    <div class="side">
      <div class="panel">
        <label>الخيار المختار:</label>
        <div id="chosenLabel" style="font-weight:800; color:var(--accent)">— لم يتم الاختيار —</div>

        <div style="height:10px"></div>

        <label>اختر القيمة المناسبة:</label>
        <select id="valueSelect"></select>

        <div class="action-row">
          <button class="btn primary" id="confirmBtn">تأكيد وتطبيق</button>
          <button class="btn ghost" id="cancelBtn">إلغاء</button>
        </div>
      </div>

      <div class="panel">
        <label>تحكم سريع:</label>
        <div class="action-row">
          <button class="btn ghost" id="skipBtn">تخطي (لا أنصح)</button>
          <button class="btn warn" id="resetBtn">إعادة تعيين اللعبة</button>
        </div>
      </div>

      <div class="panel">
        <label>السجل:</label>
        <div id="historyLog"></div>
      </div>
    </div>

  </div>

<script>
  // الحالة العامة
  let totalScore = 0;
  const totalScoreEl = document.getElementById('totalScore');
  const turnStatus = document.getElementById('turnStatus');
  const playersRow = document.getElementById('playersRow');

  // اللاعبين: تتبع الخيارات المستخدمة لكل لاعب
  // سنخزن كائن لكل لاعب: { used: { queen:true, ... }, doneCount: 0 }
  const players = [
    null,
    { used: {}, doneCount: 0 }, // لاعب 1
    { used: {}, doneCount: 0 }, // لاعب 2
    { used: {}, doneCount: 0 }, // لاعب 3
    { used: {}, doneCount: 0 }  // لاعب 4
  ];

  let currentPlayer = 1; // 1..4
  let chosenOption = null; // 'queen'|'king'|'slap'|'picker'|'trex'

  // تعاريف القيم المتاحة لكل خيار
  const optionValues = {
    queen: Array.from({length:5},(_,i)=>i), // 0..4
    slap: Array.from({length:14},(_,i)=>i), // 0..13
    king: Array.from({length:14},(_,i)=>i), // 0..13
    picker: [0,1],                         // 0 or 1
    trex: [150,200,250,300,350]            // كما طلبت (300 مرتين موجودة)
  };

  // عناصر واجهة
  const opts = document.querySelectorAll('.opt-btn');
  const chosenLabel = document.getElementById('chosenLabel');
  const valueSelect = document.getElementById('valueSelect');
  const confirmBtn = document.getElementById('confirmBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const historyLog = document.getElementById('historyLog');
  const resetBtn = document.getElementById('resetBtn');
  const skipBtn = document.getElementById('skipBtn');

  // إعداد أولي: تعطيل لوحة التأكيد لأنّه لم يتم اختيار شيء
  setChosen(null);
  renderPlayersUI();
  updateTotalUI();

  // ربط نقر الأزرار
  opts.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const key = btn.dataset.opt;
      // إذا الخيار مُستخدم بالفعل لهذا اللاعب => لا نفعل شيئاً
      if (players[currentPlayer].used[key]) {
        alert('لقد اخترت هذا الخيار سابقاً. اختر خياراً آخر.');
        return;
      }
      setChosen(key);
    });
  });

  cancelBtn.addEventListener('click', ()=> setChosen(null));

  confirmBtn.addEventListener('click', ()=>{
    if (!chosenOption) { alert('اختر خياراً ثم حدّد القيمة.'); return; }
    const val = valueSelect.value;
    if (val === null || val === undefined || val === '') { alert('يرجى اختيار قيمة'); return; }
    applyChoice(chosenOption, parseInt(val));
  });

  resetBtn.addEventListener('click', resetGame);

  skipBtn.addEventListener('click', ()=>{
    // السماح بتخطي خيار للاعب (سجّل كمنجز بدون تطبيق نقاط) — لكن المستخدم قال "لا أنصح"
    if (!confirm('هل تريد تخطي اختيار دون إضافة نقاط لهذا الخيار؟')) return;
    // نأخذ الخيار المُختار الآن إن وجد، وإلا نطلب اختياره
    if (!chosenOption) { alert('اختر خياراً لتخطيه (سيعتبر منجزاً دون نقاط).'); return; }
    players[currentPlayer].used[chosenOption] = true;
    players[currentPlayer].doneCount++;
    addLog(`اللاعب ${currentPlayer} تخطّى ${labelOf(chosenOption)} (بدون نقاط)`);
    setChosen(null);
    checkMoveNextOrEnd();
  });

  // وظائف مساعدة

  function setChosen(optKey) {
    chosenOption = optKey;
    // عرض التسمية
    if (!optKey) {
      chosenLabel.textContent = '— لم يتم الاختيار —';
      valueSelect.innerHTML = '<option value="">اختر خياراً</option>';
      confirmBtn.disabled = true;
      return;
    }
    chosenLabel.textContent = labelOf(optKey);
    // ملأ select بالقيم المناسبة
    const vals = optionValues[optKey] || [];
    valueSelect.innerHTML = '';
    vals.forEach(v=>{
      const op = document.createElement('option');
      op.value = v;
      op.textContent = v;
      valueSelect.appendChild(op);
    });
    confirmBtn.disabled = false;
  }

  function labelOf(key){
    switch(key){
      case 'queen': return 'بنات';
      case 'king': return 'دينار';
      case 'slap': return 'لطش';
      case 'picker': return 'ختيار';
      case 'trex': return 'تركس';
      default: return key;
    }
  }

  function applyChoice(optKey, value){
    // تحديد النقاط بحسب القواعد:
    let points = 0;
    if (optKey === 'queen') points = -25 * value;
    else if (optKey === 'king') points = -10 * value;
    else if (optKey === 'slap') points = -15 * value;
    else if (optKey === 'picker') points = (value === 1) ? -75 : 0;
    else if (optKey === 'trex') points = value;

    // تعديل المجموع الكلي
    totalScore += points;
    updateTotalUI();

    // تمييز الخيار كمستخدم لهذا اللاعب
    players[currentPlayer].used[optKey] = true;
    players[currentPlayer].doneCount++;

    // إضافة سجل
    addLog(`اللاعب ${currentPlayer} اختار ${labelOf(optKey)} (قيمة: ${value}) → ${points} نقطة`);

    // منع إعادة الاختيار بصرياً (لللاعب الحالي) — لكن سنبقي زر ظاهرًا لأنه يُستخدم من لاعبين آخرين
    // سنتحديث الواجهة حسب اللاعب النشط أدناه
    setChosen(null);
    checkMoveNextOrEnd();
  }

  function updateTotalUI(){
    totalScoreEl.textContent = totalScore;
  }

  function addLog(text){
    const d = new Date();
    const time = d.toLocaleTimeString('ar-EG');
    const div = document.createElement('div');
    div.className = 'log-item';
    div.textContent = `[${time}] ${text}`;
    historyLog.prepend(div);
  }

  function renderPlayersUI(){
    // تظليل اللاعب النشط وإظهار زر الخيار مع تعطيل إن استُخدم سابقاً
    for (let i=1;i<=4;i++){
      const el = document.getElementById(`player-${i}`);
      if (!el) continue;
      if (i === currentPlayer) el.classList.add('active'); else el.classList.remove('active');
    }

    // تعطيل أزرار الخيارات التي استُخدمت من قبل اللاعب الحالي
    opts.forEach(btn=>{
      const key = btn.dataset.opt;
      if (players[currentPlayer].used[key]) btn.classList.add('disabled');
      else btn.classList.remove('disabled');
    });

    turnStatus.textContent = `الدور: اللاعب ${currentPlayer} من 4 — الخيارات المنجزة: ${players[currentPlayer].doneCount}/5`;
  }

  function checkMoveNextOrEnd(){
    // إذا أنهى اللاعب الخمس خيارات ننتقل للاعب التالي (أو نعلن الانتهاء إذا كان اللاعب 4)
    if (players[currentPlayer].doneCount >= 5) {
      addLog(`اللاعب ${currentPlayer} أنهى خيارهـم الخمسة.`);
      if (currentPlayer < 4) {
        currentPlayer++;
        addLog(`الآن دور اللاعب ${currentPlayer}.`);
        setTimeout(()=>{ renderPlayersUI(); }, 150);
      } else {
        // انتهت اللعبة
        addLog('انتهت اللعبة! جميع اللاعبين أكملوا الخيارات الخمسة.');
        // تعطيل كل الأزرار
        opts.forEach(btn=> btn.classList.add('disabled'));
        setChosen(null);
        turnStatus.textContent = `انتهت اللعبة — المجموع النهائي: ${totalScore}`;
      }
    } else {
      // لم ينتهِ بعد — فقط حدّث الواجهة
      renderPlayersUI();
    }
  }

  function resetGame(){
    if (!confirm('هل تريد إعادة تعيين اللعبة وإفراغ السجل والمجموع؟')) return;
    totalScore = 0;
    // إعادة تهيئة اللاعبين
    for (let i=1;i<=4;i++){ players[i].used = {}; players[i].doneCount = 0; }
    currentPlayer = 1;
    historyLog.innerHTML = '';
    updateTotalUI();
    renderPlayersUI();
    setChosen(null);
    addLog('اللعبة أُعيدت إلى البداية.');
  }

  // عند التحميل: تأكد من أن واجهة الخيارات صحيحة
  renderPlayersUI();

</script>

</body>
</html>

